---

- group: name={{ hadoop_group }} state=present
- user:  
    name: "{{ hadoop_user }}" 
    comment: "Hadoop user" 
    group: "{{ hadoop_group }}" 
    shell: /bin/bash
    generate_ssh_key: yes
    ssh_key_bits: 2048
    ssh_key_file: .ssh/id_rsa
    password: $6$fY.WgYz2$sd/p3MR5rCwPVvNFMryF20ZgCZ2g7RCrtQSplPiBnBWXErOC0UQ5mdLOWKXEbCfNKT/HArxO0yNNCVDkoW5vU1


- name: "Build hosts file"
  lineinfile: dest=/etc/hosts regexp='{{ item.ip }}' line="{{ item.ip }} {{ item.hostname }}" state=present 
  with_items: "{{ nodes }}"

- lineinfile: dest=/home/hadoop/.bashrc regexp="JAVA_HOME=" line="export JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk"
- lineinfile: dest=/home/hadoop/.bashrc regexp="HADOOP_HOME=" line="export HADOOP_HOME=/u02/hadoop-{{ hadoop_version }}"
- lineinfile: dest=/home/hadoop/.bashrc regexp="PATH=" line="export PATH=$PATH:$HADOOP_HOME/bin"
- lineinfile: dest=/home/hadoop/.bashrc regexp="HADOOP_MAPRED_HOME=" line="export HADOOP_MAPRED_HOME=$HADOOP_HOME"
- lineinfile: dest=/home/hadoop/.bashrc regexp="HADOOP_COMMON_HOME=" line="export HADOOP_COMMON_HOME=$HADOOP_HOME"
- lineinfile: dest=/home/hadoop/.bashrc regexp="HADOOP_HDFS_HOME=" line="export HADOOP_HDFS_HOME=$HADOOP_HOME"
- lineinfile: dest=/home/hadoop/.bashrc regexp="YARN_HOME=" line="export YARN_HOME=$HADOOP_HOME"
- lineinfile: dest=/home/hadoop/.bashrc regexp="HADOOP_COMMON_LIB_NATIVE_DIR=" line="export HADOOP_COMMON_LIB_NATIVE_DIR=$HADOOP_HOME/lib/native"
- lineinfile: dest=/home/hadoop/.bashrc regexp="HADOOP_OPTS=" line="export HADOOP_OPTS=\"-Djava.library.path=$HADOOP_HOME/lib\""

